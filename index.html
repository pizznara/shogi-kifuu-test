<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>3åˆ†ã§åˆ†ã‹ã‚‹ï¼æ£‹é¢¨è¨ºæ–­</title>
<style>
  :root{
    --ink:#0f172a;
    --brand1:#ea580c;
    --brand2:#f59e0b;
    --card:#ffffffcc;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  /* èƒŒæ™¯ã¯å˜è‰²ï¼‹å°‘æ•°ã®æµ®éŠé§’ï¼ˆç”»åƒï¼‰ */
  body{
    margin:0;color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background-color:#fffdf7;
    padding: 40px 0;
    overflow-x:hidden;
  }
  /* ãµã‚ãµã‚é§’ï¼ˆã‚ãªãŸã®ç”»åƒã‚’å†åˆ©ç”¨ã—ã¦5ã€œ6å€‹ã ã‘ï¼‰ */
  .floaters img{
    position:fixed;opacity:.22;pointer-events:none;filter:blur(.2px);
    animation: float 18s linear infinite, drift 10s ease-in-out infinite alternate;
    will-change: transform;
  }
  .f1{left:6%;  top:72%; width:72px; height:auto; animation-delay:-16s}
  .f2{left:14%; top:20%; width:64px; height:auto; animation-delay:-6s}
  .f3{left:78%; top:12%; width:80px; height:auto; animation-delay:-9s}
  .f4{left:86%; top:68%; width:60px; height:auto; animation-delay:-12s}
  .f5{left:32%; top:10%; width:68px; height:auto; animation-delay:-3s}
  .f6{left:64%; top:82%; width:66px; height:auto; animation-delay:-7s}
  @keyframes float{0%{transform:translateY(0)}100%{transform:translateY(-40px)}}
  @keyframes drift{0%{transform:translateX(0) rotate(0)}100%{transform:translateX(12px) rotate(3deg)}}

  .wrap{max-width:1400px;margin:0 auto;padding:40px 24px 80px;position:relative}
  .header{
    display:flex;align-items:center;gap:14px;margin-bottom:10px;padding:10px 14px;border-radius:18px;
    background:linear-gradient(135deg,#fff,#fff8);backdrop-filter:blur(6px);
    box-shadow:0 8px 30px rgba(0,0,0,.08)
  }
  /* ãƒ­ã‚´ç”»åƒï¼ˆã‚ãªãŸã®ç”»åƒURLï¼‰ */
  .logo{width:56px;height:64px;flex:0 0 auto;filter: drop-shadow(0 4px 12px rgba(0,0,0,.25))}
  .logo img{width:100%;height:100%;object-fit:contain;display:block}

  .title h1{margin:0;font-size:24px;letter-spacing:.5px}
  .badge{
    font-size:12px;color:#92400e;border:1px dashed #fbbf24;
    background:#fffbeb;border-radius:999px;padding:4px 10px
  }

  .progress{margin:14px 0 6px}
  .bar{height:10px;border-radius:999px;background:#fde68a66;overflow:hidden; box-shadow:inset 0 0 0 1px #fcd34d66}
  .bar>span{display:block;height:100%;background:linear-gradient(90deg,var(--brand1),var(--brand2)); transition:width .25s}
  .progtext{font-size:12px;color:#6b7280;margin-top:6px}

  .card{
    background:var(--card);border:1px solid #fcd34d88;border-radius:20px;
    backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(0,0,0,.1);
    padding:22px;position:relative;overflow:hidden;z-index:1; /* ã‚¯ãƒªãƒƒã‚¯å¡ãå¯¾ç­– */
  }
  .card::after{
    content:"";position:absolute;inset:auto -30% -30% -30%;height:140px;
    background:radial-gradient(300px 80px at 40% 0,#ffd19b55,transparent 60%);
    filter:blur(12px);pointer-events:none;z-index:0; /* ã‚¯ãƒªãƒƒã‚¯é€šã™ */
  }

  .lead{font-size:16px;line-height:1.85}
  .cta{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
  .btn{
    border:none;border-radius:14px;padding:12px 18px;font-weight:800;cursor:pointer;
    transition: transform .06s ease, filter .2s ease, box-shadow .2s ease;
  }
  .btn.primary{background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; box-shadow:0 8px 18px rgba(245,158,11,.35)}
  .btn.ghost{background:#fff;border:1px solid #fcd34d99}
  .btn:hover{filter:saturate(1.08)}
  .btn:active{transform:scale(.98)}

  img.board{width:70%;height:auto;border:1px solid #fcd34d66;border-radius:14px;background:#fff}
  .qchip{display:inline-block;font-size:12px;color:#b45309;background:#fff7ed;border:1px solid #fcd34d;border-radius:999px;padding:4px 10px}
  .qtitle{margin:.5rem 0 .6rem;font-size:20px;font-weight:800;letter-spacing:.3px}

  .opt{display:block;text-align:left;position:relative;border:1px solid #e5e7eb;border-radius:14px;padding:14px 16px;cursor:pointer;background:#fff;transition:transform .06s, box-shadow .15s, border-color .15s, background .15s}
  .opt:hover{background:#fffaf2; box-shadow:0 6px 16px rgba(245,158,11,.12)}
  .opt.sel{border-color:#f59e0b; background:#fff3d6; box-shadow:0 8px 18px rgba(245,158,11,.2); transform:translateY(1px)}
  .opt .tick{position:absolute; right:12px; top:50%; transform:translateY(-50%); opacity:.0; transition:opacity .12s}
  .opt.sel .tick{opacity:1}

  .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
  .metrics{display:grid;grid-template-columns:1fr 1fr; gap:14px}
  .meter .cap{font-size:12px;color:#6b7280;margin-bottom:6px;display:flex;align-items:center;gap:6px}
  .meter .rail{height:12px;border-radius:999px;background:#f1f5f9;overflow:hidden; box-shadow:inset 0 0 0 1px #e2e8f0}
  .meter .fill{height:100%;transition:width .5s;border-radius:999px}
  .fill.attack{background:linear-gradient(90deg,#ef4444,#f97316)}
  .fill.def{background:linear-gradient(90deg,#3b82f6,#22d3ee)}

  .toast{
    position:fixed; left:50%; bottom:24px; transform:translateX(-50%) translateY(30px);
    opacity:0; transition: all .25s; background:#111827; color:#fff; font-size:14px;
    padding:10px 14px; border-radius:10px; box-shadow:0 8px 20px rgba(0,0,0,.3); z-index:40
  }
  .toast.show{opacity:1; transform:translateX(-50%) translateY(0)}
  canvas#confetti{position:fixed; inset:0; pointer-events:none; z-index:30}

  @media (prefers-reduced-motion: reduce){
    .floaters img{ animation:none }
  }
</style>
</head>
<body>

<!-- èƒŒæ™¯ã®â€œãµã‚ãµã‚é§’â€ï¼šåŒã˜ç”»åƒã‚’å†åˆ©ç”¨ï¼ˆè»½ã„ï¼†ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ãï¼‰ -->
<div class="floaters" aria-hidden="true">
  <img src="https://shogicobin.com/wp-content/uploads/2025/10/f4205a7fc8c643dc3b86b8c5b1e653d7.png" alt="" class="f1" width="72" height="72">
  <img src="https://shogicobin.com/wp-content/uploads/2025/10/f4205a7fc8c643dc3b86b8c5b1e653d7.png" alt="" class="f2" width="64" height="64">
  <img src="https://shogicobin.com/wp-content/uploads/2025/10/f4205a7fc8c643dc3b86b8c5b1e653d7.png" alt="" class="f3" width="80" height="80">
  <img src="https://shogicobin.com/wp-content/uploads/2025/10/f4205a7fc8c643dc3b86b8c5b1e653d7.png" alt="" class="f4" width="60" height="60">
  <img src="https://shogicobin.com/wp-content/uploads/2025/10/f4205a7fc8c643dc3b86b8c5b1e653d7.png" alt="" class="f5" width="68" height="68">
  <img src="https://shogicobin.com/wp-content/uploads/2025/10/f4205a7fc8c643dc3b86b8c5b1e653d7.png" alt="" class="f6" width="66" height="66">
</div>
<canvas id="confetti"></canvas>

<div class="wrap">
  <div class="header">
    <div class="logo">
      <img src="https://shogicobin.com/wp-content/uploads/2025/10/7f77967499ec98656f31e6e1af45590c.png" alt="å°†æ£‹ãƒ­ã‚´" width="56" height="64">
    </div>
    <div class="title">
      <h1>3åˆ†ã§åˆ†ã‹ã‚‹ï¼æ£‹é¢¨è¨ºæ–­</h1>
      <div class="badge" id="subtitle">å°†æ£‹ã‚«ãƒ•ã‚§COBINå…¬å¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</div>
    </div>
  </div>

  <!-- é€²æ— -->
  <div class="progress">
    <div class="bar"><span id="progress" style="width:0%"></span></div>
    <div class="progtext">é€²æ—ï¼š<span id="progNum">0</span> / <span id="progDen">8</span></div>
  </div>

  <!-- ç”»é¢ -->
  <div id="screen" class="card"></div>
</div>
<div class="toast" id="toast"></div>

<script>
/* ====== æ–‡è¨€ã‚«ã‚¹ã‚¿ãƒ ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰ ====== */
const BRAND_NAME     = "COBIN";                           // ã‚³ãƒ”ãƒ¼æ–‡é ­ã«ä½¿ã‚ã‚Œã‚‹
const SUBTITLE_TEXT  = "å°†æ£‹ã‚«ãƒ•ã‚§COBINå…¬å¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„";  // ã‚¿ã‚¤ãƒˆãƒ«ä¸‹ãƒãƒƒã‚¸

/* ====== è¨­å•ãƒ‡ãƒ¼ã‚¿ï¼ˆé…ç‚¹ã¯éè¡¨ç¤ºï¼‰ ====== */
const DATA = {
  questions: [
    { id:1,prompt:"å›³ã¯â–³ï¼˜å…«æ­©ã¾ã§ã€‚æ¬¡ã®ä¸€æ‰‹ã¯ï¼Ÿ",imageUrl:"https://shogicobin.com/wp-content/uploads/2025/11/4f9ad48613c506e3c3f986b66e29434b.png",alt:"Q1",
      options:[{label:"â–²ï¼˜å…«åŒé‡‘ï¼šä¸å¯§ã«å¯¾å¿œã—ã¦ã€æ­©å¾—ã‚’ä¸»å¼µã™ã‚‹",A:0,D:10},{label:"â–²ï¼’å››æ­©ï¼šæ•µç‰ã¯è–„ã„ã®ã§ã€ã“ã®ç¬é–“ã«æ”»ã‚åˆã„",A:10,D:0},{label:"â–²ï¼“å››éŠ€ï¼šæ•µç‰ã¯è–„ã„ã€‚éŠ€ã‚’ã¯ãŒã—ã¦æ›´ã«è–„ãã™ã‚‹",A:10,D:0},{label:"â–²ï¼—ä¸ƒæ¡‚ï¼šæ¡‚ã¯å–ã‚‰ã‚ŒãŸããªã„ã€‚å¾Œã§â–²ï¼–äº”æ¡‚ã¨æ´»ç”¨ã™ã‚‹å«ã¿ã‚‚",A:4,D:6}]},
    { id:2,prompt:"å›³ã¯â–³ï¼•ä¸ƒæ­©æˆã¾ã§ã€‚æ¬¡ã®ä¸€æ‰‹ã¯ï¼Ÿ",imageUrl:"https://shogicobin.com/wp-content/uploads/2025/11/89ff19b70d3eb0a6e546a763b61e01b6.png",alt:"Q2",
      options:[{label:"â–²ï¼’å››æ­©ï¼šç‰é ­ã«å‘³ã‚’ã¤ã‘ã¦ã€æ”»ã‚åˆã„ã®å½¢ã‚’ä½œã‚‹",A:8,D:2},{label:"â–²ï¼’å››æ¡‚ï¼šæ‰‹ç­‹ã®æ¡‚ã®æ‰“ã¡è¾¼ã¿ã§å³ã—ãè¿«ã‚‹",A:10,D:0},{label:"â–²ï¼•å…«æ­©ï¼šè¿‘ãã«ã¨é‡‘ãŒã„ã¦å«Œãªå½¢ã€‚ä¸€æ—¦ã¨é‡‘ã‚’è²¬ã‚ã‚‹",A:2,D:8},{label:"â–²ï¼—ä¸ƒé‡‘æ‰“ï¼šã•ã™ãŒã«è‡ªç‰ãŒå±ãªã„ã€‚é‡‘ã‚’æ‰“ã£ã¦è£œå¼·ã™ã‚‹",A:0,D:10}]},
    { id:3,prompt:"å›³ã¯â–³ï¼”ä¸ƒé¦¬ã¾ã§ã€‚æ¬¡ã®ä¸€æ‰‹ã¯ï¼Ÿ",imageUrl:"https://shogicobin.com/wp-content/uploads/2025/11/3a41f1dab95a2997e6e4308304d62d31.png",alt:"Q3",
      options:[{label:"â–²ï¼•ä¸‰æ­©ï¼šæ‰‹ç­‹ã®å©ãã§ä¸€æ‰‹å‹ã¡ã‚’ç›®æŒ‡ã™",A:9,D:1},{label:"â–²ï¼™äº”æ­©ï¼šç¾æ¿ƒå›²ã„ã®æ€¥æ‰€ã€ç«¯ã‚’æ”»ã‚ã‚‹",A:10,D:0},{label:"â–²ï¼•ä¹é‡‘ï¼šæŒã¡é§’ã¯è±Šå¯Œã€‚è´…æ²¢ã«å…ˆæ‰‹ã§é‡‘ã‚’æ‰“ã£ã¦è£œå¼·",A:0,D:10},{label:"â–²ï¼“äº”è§’ï¼šæ”»é˜²ã«åˆ©ã‹ã›ã‚‹å‘³ã®è‰¯ã„è§’æ‰“ã¡",A:5,D:5}]},
    { id:4,prompt:"å›³ã¯â–³ï¼˜ä¹é¦¬ã¾ã§ã€‚æ¬¡ã®ä¸€æ‰‹ã¯ï¼Ÿ",imageUrl:"https://shogicobin.com/wp-content/uploads/2025/11/8a6a5781ccaba672502e6f225d142ea7.png",alt:"Q4",
      options:[{label:"â–²ï¼–ä¸ƒæ­©ï¼šï¼–å…­ã®éŠ€ãŒæµ®ã„ã¦ã„ã‚‹ã®ã§ã€æ­©ã§æ”¯ãˆã¦ãŠã‘ã°å®‰å¿ƒ",A:2,D:8},{label:"â–²ï¼–äº”éŠ€ï¼šç‹™ã‚ã‚Œã¦ã„ã‚‹éŠ€ã‚’é€ƒã’ã¤ã¤ã€æ¬¡ã«â–²ï¼–å››æ­©ã‹ã‚‰æ”»ã‚ã‚‹ç‹™ã„",A:8,D:2},{label:"â–²ï¼–å››æ­©ï¼šå–ã‚‰ã›ã¦å…ˆæ‰‹ã§â–²ï¼–ä¸€é£›ã¨æ•µé™£ã«é£›è»Šã‚’æ‰“ã¡è¾¼ã‚€ç‹™ã„",A:10,D:0},{label:"â–²ï¼–ä¹é£›æ‰“ï¼šç›¸æ‰‹ã«ä½•ã‚‚ã•ã›ãªã„ã€‚è‡ªåˆ†ã ã‘â–²ï¼˜äºŒæ­©ã‹ã‚‰ã¼ã¡ã¼ã¡æ”»ã‚ã¦ã„ã",A:0,D:10}]},
    { id:5,prompt:"å›³ã¯â–³ï¼•å…­éŠ€æˆã¾ã§ã€‚æ¬¡ã®ä¸€æ‰‹ã¯ï¼Ÿ",imageUrl:"https://shogicobin.com/wp-content/uploads/2025/11/b0ecdfda877f03fc871a3d80cb5947ba.png",alt:"Q5",
      options:[{label:"â–²ï¼“å…­æ¡‚ï¼šæŒã¡é§’ã¯è±Šå¯Œã€‚æ”»ã‚åˆã£ã¦ä¸€æ‰‹å‹ã¡",A:7,D:3},{label:"â–²ï¼“ä¹é‡‘æ‰“ï¼šç‰‡ç¾æ¿ƒã§ã¯è–„ã™ãã‚‹ã€‚ä¸€æ—¦å›ºã‚ã¦ãŠã",A:10,D:0},{label:"â–²ï¼•ä¹é¦™ï¼šè‡ªé™£ã‚’å®‰å…¨ã«ã—ã¤ã¤æˆéŠ€ã‚’è²¬ã‚ã‚‹å‘³ã®è‰¯ã„é¦™æ‰“ã¡",A:3,D:7},{label:"â–²ï¼”å››é¦™ï¼šã“ã®ç¬é–“è‡ªé™£ã¯å …ã„ã€‚è±Šå¯ŒãªæŒã¡é§’ã§ä¸€æ°—ã«æ”»ã‚åˆ‡ã‚‹",A:10,D:0}]},
    { id:6,prompt:"å›³ã¯â–³ï¼•ä¹ç«œã¾ã§ã€‚æ¬¡ã®ä¸€æ‰‹ã¯ï¼Ÿ",imageUrl:"https://shogicobin.com/wp-content/uploads/2025/11/c2d34df85d952c96c293f9898da44605.png",alt:"Q6",
      options:[{label:"â–²ï¼•ä¸‰é¦¬ï¼šè‡ªç„¶ã«æ”»ã‚ã¦ç©´ç†Šãƒšãƒ¼ã‚¹",A:8,D:2},{label:"â–²ï¼’äºŒé¦¬ï¼šç«œã®åˆ©ãã‚’é€šã—ã¤ã¤ã€é¦¬ã‚’è‡ªé™£ã«åˆ©ã‹ã›ã‚‹",A:1,D:9},{label:"â–²ï¼—ä¸‰é¦™ï¼šè‡ªé™£ã¯å›ºã„ã€‚å³ã—ãæ”»ã‚ã¦ã„ã",A:10,D:0},{label:"â–²ï¼–ä¸ƒéŠ€æ‰“ï¼šâ–³ï¼–å…­æ¡‚ã‚’æ¶ˆã—ã¤ã¤ã€æµ®ãé§’ã‚‚ãªãã™å‘³ã®è‰¯ã„éŠ€æ‰“ã¡",A:0,D:10}]},
    { id:7,prompt:"å›³ã¯â–³ï¼–äº”æ¡‚ã¾ã§ã€‚æ¬¡ã®ä¸€æ‰‹ã¯ï¼Ÿ",imageUrl:"https://shogicobin.com/wp-content/uploads/2025/11/42c4119e82b97f3a53929e9082ef4ae0.png",alt:"Q7",
      options:[{label:"â–²ï¼”å››æ­©ï¼šé£›è»Šã‚’æ´»ã‹ã—ã¦æ‹ ç‚¹ã‚’ä½œã‚‹",A:7,D:3},{label:"â–²ï¼—ä¸ƒæ­©ï¼šé£›è»Šã®ç›´é€šã‚„â–³ï¼—å…­æ¡‚ã‚’æ¶ˆã—ã¦ãŠã",A:0,D:10},{label:"â–²ï¼™ä¸ƒè§’ï¼šç‹æ‰‹ã‚’ã‹ã‘ã¤ã¤è‡ªé™£ã‚’å—ã‘ã‚‹",A:3,D:7},{label:"â–²ï¼–ä¸€è§’ï¼šæ€¥æ‰€ã®è§’æ‰“ã¡",A:8,D:2}]},
    { id:8,prompt:"å›³ã¯â–³ï¼™äºŒé£›ã¾ã§ã€‚æ¬¡ã®ä¸€æ‰‹ã¯ï¼Ÿ",imageUrl:"https://shogicobin.com/wp-content/uploads/2025/11/ef9f6d1cf435dddc47f7cbf1754a9d28-1.png",alt:"Q8",
      options:[{label:"â–²ï¼™å…­é¦™ï¼šç›¸æ‰‹ã®æ­©åˆ‡ã‚Œã‚’è§£æ¶ˆã•ã›ãªã„",A:0,D:10},{label:"â–²ï¼‘äº”æ­©ï¼šè±Šå¯ŒãªæŒã¡æ­©ã§ç«¯ã‚’å´©ã—ã¦ã„ã",A:10,D:0},{label:"â–²ï¼’å››æ­©ï¼šè±Šå¯ŒãªæŒã¡æ­©ã§ç‰é ­ã‚’æ”»ã‚ã¦ã„ã",A:9,D:1},{label:"â–²ï¼˜ä¸ƒéŠ€ï¼šé›¢ã‚Œé§’ã‚’å¼•ãç· ã‚ã¦è‡ªç‰ã¯è‰¯ã„å½¢ã«",A:1,D:9}]}
  ]
};

document.getElementById('subtitle').textContent = SUBTITLE_TEXT;
const screen = document.getElementById('screen');
const progressBar = document.getElementById('progress');
const progNum = document.getElementById('progNum');
const progDen = document.getElementById('progDen');
const toast = document.getElementById('toast');
progDen.textContent = DATA.questions.length;

let step=0;                // 0=èª¬æ˜, 1..N=è¨­å•, N+1=çµæœ
const picks={};            // { qid: optionIndex }
let autoAdvancing=false;   // äºŒé‡ã‚¯ãƒªãƒƒã‚¯é˜²æ­¢

/* file:// ã§ã‚‚ç¢ºå®Ÿã«æŠ¼ã›ã‚‹ã‚ˆã†ã€ŒäºŒé‡èµ·å‹•ã€ */
window.__start = startQuiz;
document.addEventListener('DOMContentLoaded', () => {
  const btn=document.getElementById('startBtn');
  if(btn) btn.addEventListener('click', startQuiz);
});

/* åˆæœŸæç”» */
render();

/* é€²è¡Œè¡¨ç¤º */
function setProgress(n){
  const N=DATA.questions.length;
  const pct=Math.round((Math.min(n,N)/N)*100);
  progressBar.style.width=pct+'%';
  progNum.textContent=Math.min(n,N);
}

/* ç”»é¢æç”» */
function render(){
  const N=DATA.questions.length;
  setProgress(step);

 if(step===0){
    screen.innerHTML = `
      <img src="https://shogicobin.com/wp-content/uploads/2025/11/ac16a071b1ab1c233dfc42822df46e0c.png"
           alt="æ£‹é¢¨è¨ºæ–­ãƒˆãƒƒãƒ—ç”»åƒ"
           style="width:100%;max-width:900px;display:block;margin:0 auto 24px;border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,.08)" loading="eager">
      <div class="lead">
        8å•ã®â€œæ¬¡ã®ä¸€æ‰‹â€ã«ç­”ãˆã‚‹ã ã‘ã€‚<b>ç›´è¦³ã‚„å¥½ã¿ã§OKï¼</b><br>
        ã‚ãªãŸã¯ <b>æ”»ã‚æ£‹é¢¨</b>ï¼Ÿ <b>å—ã‘æ£‹é¢¨</b>ï¼Ÿ ãã‚Œã¨ã‚‚ <b>ãƒãƒ©ãƒ³ã‚¹å‹</b>ï¼Ÿ
      </div>
      <div class="cta">
        <button class="btn primary" id="startBtn">ã¯ã˜ã‚ã‚‹ â–¶</button>
      </div>
    `;
    setProgress(0);
    const btn=document.getElementById('startBtn');
    if(btn) btn.addEventListener('click', startQuiz);
    return;
  }
  
  if(step>=1 && step<=N){
    const q=DATA.questions[step-1];
    screen.innerHTML = `
      <div class="row" style="justify-content:space-between; margin-bottom:8px;">
        <span class="qchip">Q${step} / ${N}</span>
        <span class="qchip">ç›´è¦³ã§OK âš¡ï¸</span>
      </div>
      <div class="qtitle">${escapeHTML(q.prompt)}</div>
      ${q.imageUrl?`<img class="board" src="${escapeAttr(q.imageUrl)}" alt="${escapeAttr(q.alt||'å±€é¢å›³')}">`:''}
      <div style="display:grid;gap:10px;margin-top:14px" id="opts"></div>
      <div class="row" style="margin-top:16px">
        <button class="btn ghost" id="backBtn">â¬… æˆ»ã‚‹</button>
      </div>
    `;
    const optsEl=document.getElementById('opts');
    q.options.forEach((o,i)=>{
      const b=document.createElement('button');
      b.className='opt'; b.dataset.qid=q.id; b.dataset.idx=i;
      b.innerHTML = `${escapeHTML(o.label)} <span class="tick">âœ…</span>`;
      optsEl.appendChild(b);
    });
    document.getElementById('backBtn').addEventListener('click', goBack);
    optsEl.addEventListener('click', (e)=>{
      const b=e.target.closest('button.opt'); if(!b) return;
      pickAndAutoNext(Number(b.dataset.qid), Number(b.dataset.idx), b);
    });
    return;
  }

  if(step===DATA.questions.length+1){
    // é›†è¨ˆï¼ˆ%ã¯1ã®ä½ã¾ã§ï¼‰
    let Asum=0,Dsum=0;
    DATA.questions.forEach(q=>{
      const i=picks[q.id]; if(i==null) return;
      const o=q.options[i]; Asum+=(o.A||0); Dsum+=(o.D||0);
    });
    const attack=Math.round(Asum*100/Math.max(1,(Asum+Dsum)));
    const defense=100-attack;
    const diff=attack-defense;
    let label="ãƒãƒ©ãƒ³ã‚¹å‹",desc="æ”»å®ˆã®ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ãã€çŠ¶æ³ã«å¿œã˜ã¦æŸ”è»Ÿã«æ‰‹ã‚’é¸ã¶ã‚¿ã‚¤ãƒ—ã€‚";
   if (diff >= 60) { label = "è¶…æ”»æ’ƒå‹"; desc = "è² ã‘ãªã„å°†æ£‹ã‚ˆã‚Šå‹ã¤å°†æ£‹ã€‚æ”»ã‚ã¦æ”»ã‚ã¦å‹åˆ©ã‚’ã‚‚ãå–ã‚‹ã‚¿ã‚¤ãƒ—ã€‚"; } 
   else if (diff >= 40) { label = "ã‹ãªã‚Šæ”»æ’ƒå¯„ã‚Š"; desc = "ç©æ¥µçš„ã«å‹•ãã€è‡ªåŠ›ã§ãƒšãƒ¼ã‚¹ã‚’æ´ã‚“ã§ã„ãã‚¿ã‚¤ãƒ—ã€‚"; } 
   else if (diff >= 20) { label = "ã‚„ã‚„æ”»æ’ƒå¯„ã‚Š"; desc = "ãƒãƒ£ãƒ³ã‚¹ã¯é€ƒã•ãšä¸»å°æ¨©ã‚’å–ã‚Šã«ã„ãã‚¿ã‚¤ãƒ—ã€‚"; } 
   else if (diff > -20) { label = "ãƒãƒ©ãƒ³ã‚¹å‹"; desc = "æ”»å®ˆã®ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ãã€çŠ¶æ³ã«å¿œã˜ã¦æŸ”è»Ÿã«æ‰‹ã‚’é¸ã¹ã‚‹ã‚¿ã‚¤ãƒ—ã€‚"; }
   else if (diff > -40) { label = "ã‚„ã‚„å—ã‘å¯„ã‚Š"; desc = "ç›¸æ‰‹ã®æ”»ã‚ã¯ã—ã£ã‹ã‚Šå—ã‘æ­¢ã‚ã€åæ’ƒã§å½¢å‹¢ã‚’æ´ã‚€ã‚¿ã‚¤ãƒ—ã€‚"; }
   else if (diff > -60) { label = "ã‹ãªã‚Šå—ã‘å¯„ã‚Š"; desc = "å®‰å…¨é‡è¦–ã§æ‰‹å …ãå‹ã¡ã‚„ã™ã„å±€é¢ã‚’å¥½ã‚€ã‚¿ã‚¤ãƒ—ã€‚"; }
   else { label = "è¶…å—ã‘å·§è€…"; desc = "é‰„å£ã®å®ˆå‚™ã§å‹åˆ©ã‚’ç¢ºå®Ÿãªã‚‚ã®ã¨ã™ã‚‹å—ã‘å¸«ã€‚"; }
    confettiBurst();

const resultUrl = "https://shogicobin.com/kifuu";

const rawText = `ã€å°†æ£‹ãƒ»æ£‹é¢¨è¨ºæ–­ã€‘
æ”»æ’ƒ${attack}% : å—ã‘${defense}%ï¼ˆ${label}ï¼‰
${resultUrl}
#æ£‹é¢¨è¨ºæ–­`;

const textParam = encodeURIComponent(rawText);
const intentX   = `https://x.com/intent/tweet?text=${textParam}`;

const copy = `ã€å°†æ£‹ãƒ»æ£‹é¢¨è¨ºæ–­ã€‘
æ”»æ’ƒ${attack}% : å—ã‘${defense}%ï¼ˆ${label}ï¼‰
${desc}
${resultUrl}
#æ£‹é¢¨è¨ºæ–­`;

    screen.innerHTML = `
      <div class="row" style="align-items:center; gap:10px; margin-bottom:8px">
        <div class="qchip" style="background:#dcfce7;border-color:#86efac;color:#065f46">çµæœãŒå‡ºã¾ã—ãŸï¼ğŸ‰</div>
        <div class="qchip">${new Date().toLocaleDateString()} ã®ã‚ãªãŸ</div>
      </div>
      <div class="qtitle">æ”»æ’ƒ <b>${attack}%</b> ãƒ» å—ã‘ <b>${defense}%</b>ã€€<span style="font-size:14px; opacity:.8">ï¼ˆ${label}ï¼‰</span></div>

      <div class="metrics" style="margin-top:10px">
        <div class="meter">
          <div class="cap">æ”»æ’ƒ</div>
          <div class="rail"><div class="fill attack" style="width:${attack}%"></div></div>
        </div>
        <div class="meter">
          <div class="cap">å—ã‘</div>
          <div class="rail"><div class="fill def" style="width:${defense}%"></div></div>
        </div>
      </div>

      <p style="margin-top:10px">${desc}</p>

      <div class="row" style="margin-top:14px">
        <button class="btn ghost" id="copyBtn">ğŸ“‹ çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
        <button class="btn primary" id="xBtn">X ã«ãƒã‚¹ãƒˆ</button>
        <button class="btn ghost" id="retryBtn">ğŸ” ã‚‚ã†ä¸€åº¦ã‚„ã‚‹</button>
      </div>
    `;
    document.getElementById('copyBtn').addEventListener('click', ()=>copyResult(copy));
    document.getElementById('xBtn').addEventListener('click', ()=>postToX(intentX));
    document.getElementById('retryBtn').addEventListener('click', resetAll);
    return;
  }
}

/* æ“ä½œ */
function startQuiz(){ autoAdvancing=false; step=1; render(); }
function goBack(){ step=Math.max(0, step-1); render(); }
function pickAndAutoNext(qid, idx, btnEl){
  if(autoAdvancing) return;
  picks[qid]=idx;
  const sib = btnEl.parentElement.querySelectorAll('.opt');
  sib.forEach(el=>el.classList.toggle('sel', el===btnEl));
  autoAdvancing = true;
  setTimeout(()=>{
    const N=DATA.questions.length;
    step = Math.min(N+1, step+1);
    autoAdvancing = false;
    render();
  }, 220);
}
function resetAll(){
  step=0; for(const k in picks) delete picks[k];
  render(); 
}

/* é€²æ—ãƒãƒ¼ */
function setProgress(n){
  const N=DATA.questions.length;
  const pct=Math.round((Math.min(n,N)/N)*100);
  document.getElementById('progress').style.width=pct+'%';
  document.getElementById('progNum').textContent=Math.min(n,N);
}

/* ã‚³ãƒ”ãƒ¼ï¼ˆHTTPS/ãƒ­ãƒ¼ã‚«ãƒ«ä¸¡å¯¾å¿œï¼‰ */
function copyResult(text){
  const plain=String(text);
  if(navigator.clipboard && window.isSecureContext){
    navigator.clipboard.writeText(plain).then(()=>showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼")).catch(()=>fallbackCopy(plain));
  }else{ fallbackCopy(plain); }
}
function fallbackCopy(text){
  const ta=document.createElement('textarea');
  ta.value=text; ta.setAttribute('readonly','');
  ta.style.position='fixed'; ta.style.top='-1000px';
  document.body.appendChild(ta); ta.select(); ta.setSelectionRange(0, ta.value.length);
  try{ document.execCommand('copy'); showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"); }
  catch{ showToast("ã‚³ãƒ”ãƒ¼ã§ãã¾ã›ã‚“ã§ã—ãŸâ€¦æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„"); }
  finally{ document.body.removeChild(ta); }
}
function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 1800);
}

/* Xãƒã‚¹ãƒˆï¼ˆåˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰ */
function postToX(url){
  const w=640,h=560,left=(screen.width-w)/2,top=(screen.height-h)/2;
  window.open(url, "_blank", `width=${w},height=${h},left=${left},top=${top}`);
}

/* ç´™å¹é›ªï¼ˆè»½é‡ï¼‰ */
function confettiBurst(){
  const c=document.getElementById('confetti');
  const ctx=c.getContext('2d');
  const dpr=Math.max(1, window.devicePixelRatio||1);
  c.width=innerWidth*dpr; c.height=innerHeight*dpr;
  c.style.width=innerWidth+'px'; c.style.height=innerHeight+'px';
  ctx.scale(dpr,dpr);
  const colors=['#f59e0b','#10b981','#3b82f6','#ef4444','#eab308','#8b5cf6'];
  const parts=Array.from({length:120},()=>({
    x:Math.random()*innerWidth, y:-20-Math.random()*40,
    w:6+Math.random()*6, h:10+Math.random()*10,
    r:Math.random()*Math.PI, s:.8+Math.random()*2.2, g:.07+Math.random()*.12,
    c:colors[(Math.random()*colors.length)|0]
  }));
  let t=0, anim;
  const draw=()=>{
    ctx.clearRect(0,0,innerWidth,innerHeight);
    for(const p of parts){
      p.y+=p.s*2.2; p.x+=Math.sin((t/10)+p.y/40)*.8; p.r+=.08; p.s+=p.g*0.02;
      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.r);
      ctx.fillStyle=p.c; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
      ctx.restore();
    }
    t++; if(t<220) anim=requestAnimationFrame(draw);
    else { cancelAnimationFrame(anim); ctx.clearRect(0,0,innerWidth,innerHeight); }
  };
  draw();
}

/* HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ— */
function escapeHTML(s){return String(s).replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[m]));}
function escapeAttr(s){return escapeHTML(s).replace(/`/g,"&#96;");}


document.addEventListener('click', (e) => {
  if (e.target && e.target.id === 'startBtn') {
    startQuiz();    // â† ç›´æ¥å‘¼ã¶
  }
});

</script>

<!-- é€²æ—DOMï¼ˆæœ€å¾Œã«ç½®ãã¨æç”»å®‰å®šï¼‰ -->
<div class="progress" style="position:fixed;left:-9999px;top:-9999px;opacity:0" aria-hidden="true">
  <div class="bar"><span id="progress" style="width:0%"></span></div>
  <div class="progtext">é€²æ—ï¼š<span id="progNum">0</span> / <span id="progDen">8</span></div>
</div>
</body>
</html>
